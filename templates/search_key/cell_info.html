{% extends "search_key/base.html" %}
{% load bootstrap5 %}

{% block title %}
  Search key
{% endblock %}

{% block content %}
  {% bootstrap_form_errors form layout='inline' %}
  <form method="get">
    <fieldset>
      <legend>
        <div class="col">
          <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø–æ—à—É–∫—É</h3>
        </div>
        <div class="col">
          <ul>
            {% for cell in cells %}
              <li>{{ cell.cell }} üîë<br><h2>{{ cell }}</h2></li>
            {% empty %}
              <li><h2>–í—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.</h2></li>
            {% endfor %}
          </ul>
        </div>
      </legend>
    </fieldset>
    <div class="inner-form">
      <div class="input-field first-wrap">
        {{ form.street_name }}
      </div>
      <div class="col-auto">
        {{ form.street_id }}
      </div>
      <div class="input-field second-wrap">
        {{ form.building_number }}
      </div>
      <div class="input-field third-wrap">
        <button type="submit" class="btn-search">–ü–æ—à—É–∫</button>
      </div>
    </div>
  </form>

  <script>
      $(function () {
          $("#id_street_name").autocomplete({
              source: function (request, response) {
                  $.ajax({
                      url: "{% url 'search_keys:street_autocomplete' %}",
                      dataType: "json",
                      data: {
                          term: request.term
                      },
                      success: function (data) {
                          response($.map(data, function (item) {
                              return {
                                  label: item.named,
                                  value: item.named,
                                  street_id: item.street_id
                              };
                          }));
                      }
                  });
              },
              minLength: 2, // Minimum characters before triggering autocomplete
              select: function (event, ui) {
                  // Set the selected street_id to #id_num_street
                  $("#id_street_id").val(ui.item.street_id);
              }
          });
      });

      // Function to clear the contents of an input field with id "id_street_name"
      function clearInput() {
          document.getElementById("id_street_name").value = "";
      }
  </script>

{% endblock %}