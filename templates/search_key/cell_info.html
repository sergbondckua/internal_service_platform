{% extends "base.html" %}
{% load bootstrap5 %}
{% load crispy_forms_filters %}

{% block title %}
  cell title
{% endblock %}

{% block content %}
  {% bootstrap_form_errors form layout='inline' %}
  <form role="form" class="row g-3" method="get">
    <div class="col-auto">
      {% bootstrap_field form.prefix size="large" layout="inline" %}
    </div>
    <div class="col-auto">
      {% bootstrap_field form.street_name layout="inline" %}
    </div>
    <div class="col-auto">
      {% bootstrap_field form.street_id layout="inline" %}
    </div>
    <div class="col-auto">
      {% bootstrap_field form.building_number layout="inline" %}
    </div>
    <div class="col-auto">
      {% buttons layout="inline" %}
        <button type="submit" class="btn btn-success btn-lg">Пошук</button>
      {% endbuttons %}
    </div>
  </form>
  <div class="col">
    <h2>Search Results</h2>
  </div>
  <div class="col">
    {% if cells %}
      <ul>
        {% for cell in cells %}
          <li><h1>{{ cell.cell }}</h1><br> {{ cell }}</li>
        {% endfor %}
      </ul>
    {% else %}
      <p>No matching results found.</p>
    {% endif %}
  </div>

  <script>
      $(function () {
          $("#id_street_name").autocomplete({
              source: function (request, response) {
                  $.ajax({
                      url: "{% url 'search_keys:street_autocomplete' %}",
                      dataType: "json",
                      data: {
                          term: request.term
                      },
                      success: function (data) {
                          response($.map(data, function (item) {
                              return {
                                  label: item.named,
                                  value: item.named,
                                  street_id: item.street_id
                              };
                          }));
                      }
                  });
              },
              minLength: 2, // Minimum characters before triggering autocomplete
              select: function (event, ui) {
                  // Set the selected street_id to #id_num_street
                  $("#id_street_id").val(ui.item.street_id);
              }
          });
      });
  </script>


{% endblock %}